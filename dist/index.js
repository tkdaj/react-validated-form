import e from"react";import{connect as o}from"react-redux";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var r=function(e,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var r in o)o.hasOwnProperty(r)&&(e[r]=o[r])})(e,o)};function t(e,o){function t(){this.constructor=e}r(e,o),e.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)}var n=function(){return(n=Object.assign||function(e){for(var o,r=1,t=arguments.length;r<t;r++)for(var n in o=arguments[r])Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);return e}).apply(this,arguments)};function a(e,o){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(r[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(e);n<t.length;n++)o.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(e,t[n])&&(r[t[n]]=e[t[n]])}return r}var i=["BUTTON"],s=function(e){return!i.includes(e.tagName)},l=function(e){return e?Array.from(e.elements).filter((function(e){return s(e)})):[]},u=function(e,o,r){var t,n;void 0===r&&(r=!1);var a="checkbox"===e.type,i="radio"===e.type,s=a?e.checked:e.value;r&&(o.initialFieldValues[e.name]?s=o.initialFieldValues[e.name]:a?s=!1:i?(s="",e.checked=!1):s="",e[a?"checked":"value"]=s),e.setCustomValidity("");var l=null===(t=o.customValidators[e.name])||void 0===t?void 0:t.isValid,u=l?l(s):e.checkValidity(),m=null===(n=o.customValidators[e.name])||void 0===n?void 0:n.errorText;return m?u||e.setCustomValidity(m):m=e.validationMessage,{value:s,error:u?"":m}},m=function(o){function r(){var r=null!==o&&o.apply(this,arguments)||this;return r.state={submissionAttempted:!1,formIsValid:!1,formValues:{}},r.formRef=e.createRef(),r.onFormSubmit=function(e){e.preventDefault(),r.setState({submissionAttempted:!0},(function(){var o,t,a,i,s,l,u;r.state.formIsValid?null===(t=null===(o=r.props)||void 0===o?void 0:o.onValidSubmissionAttempt)||void 0===t||t.call(o,e,n({},r.state.formValues)):null===(i=null===(a=r.props)||void 0===a?void 0:a.onInvalidSubmissionAttempt)||void 0===i||i.call(a,e,n({},r.state.formValues)),null===(l=(s=r.props).onFormChanged)||void 0===l||l.call(s,null===(u=r.formRef)||void 0===u?void 0:u.current,r.state)}))},r.fieldChanged=function(e){var o=e.target,t=u(o,r.props);r.setState((function(e){var a,i,s,l=n(n({},e.formValues),((a={})[o.name]=t,a)),u=n(n({},e),{formValues:l,formIsValid:!Object.values(l).find((function(e){return e.error}))});return null===(s=(i=r.props).onFormChanged)||void 0===s||s.call(i,o,u),u}))},r.getFormData=function(){return n(n({},r.state),{formValues:Object.keys(r.state.formValues).reduce((function(e,o){var t;return n(n({},e),((t={})[o]=n({},r.state.formValues[o]),t))}),{})})},r.resetForm=function(){var e=l(r.formRef.current).reduce((function(e,o){var t,a=u(o,r.props,!0);return n(n({},e),((t={})[o.name]=a,t))}),{}),o={submissionAttempted:!1,formValues:e,formIsValid:!Object.values(e).find((function(e){return e.error}))};r.setState(o,(function(){var e,o;return null===(o=(e=r.props).onFormChanged)||void 0===o?void 0:o.call(e,r.formRef.current,r.state)}))},r}return t(r,o),r.prototype.componentDidMount=function(){var e,o=this;l(null===(e=this.formRef)||void 0===e?void 0:e.current).forEach((function(e){var r,t;e.name?(null===(r=o.props.customValidators[e.name])||void 0===r?void 0:r.isValid)&&!(null===(t=o.props.customValidators[e.name])||void 0===t?void 0:t.errorText)&&console.error("A custom error message must be provided when using a custom isValid function for field:",e):s(e)&&console.error("You must have a name on all form fields within ValidatedForm",e)})),this.resetForm()},r.prototype.render=function(){var o=this,r=this.props,t=(r.onInvalidSubmissionAttempt,r.onValidSubmissionAttempt,r.customValidators,r.className),i=r.children,s=(r.initialFieldValues,r.formErrorClass),l=(r.onFormChanged,a(r,["onInvalidSubmissionAttempt","onValidSubmissionAttempt","customValidators","className","children","initialFieldValues","formErrorClass","onFormChanged"])),u=this.state,m=u.submissionAttempted,d=u.formIsValid;return e.createElement("form",n({ref:this.formRef,onSubmit:this.onFormSubmit},l,{className:"validated-form "+(m?"validated-form-submission-attempted ":"")+(d?"":s)+(null!=t?t:"")}),e.Children.toArray(i).map((function(r){var t,a;return"button"===r.type?r:e.cloneElement(r,n(n({},r.props),{value:null!==(a=null===(t=o.state.formValues[r.props.name])||void 0===t?void 0:t.value)&&void 0!==a?a:"",onChange:r.props.onChange?function(e){o.fieldChanged(e),r.props.onChange(e)}:o.fieldChanged}))})))},r.defaultProps={customValidators:{},initialFieldValues:{},formErrorClass:"validated-form-error"},r}(e.Component),d="UPDATE_VALIDATED_FORM",p="CLEAR_VALIDATED_FORM",f="INIT_VALIDATED_FORM",c=o((function(e){return{reduxForms:e.validatedForms}}),{updateValidatedForm:function(e){var o=e.newFormState,r=e.formName;return{type:d,payload:{formName:r,newFormState:o}}}},null,{forwardRef:!0})(function(o){function r(){var r=null!==o&&o.apply(this,arguments)||this;return r.formRef=e.createRef(),r.onFormSubmit=function(e){var o,t,a,i;e.preventDefault();var s=n(n({},r.props.reduxForms[r.props.name]),{submissionAttempted:!0});r.props.updateValidatedForm({formName:r.props.name,newFormState:s}),r.props.reduxForms[r.props.name].formIsValid?null===(t=null===(o=r.props)||void 0===o?void 0:o.onValidSubmissionAttempt)||void 0===t||t.call(o,e,n({},s.formValues)):null===(i=null===(a=r.props)||void 0===a?void 0:a.onInvalidSubmissionAttempt)||void 0===i||i.call(a,e,n({},s.formValues))},r.fieldChanged=function(e){var o,t=e.target,a=u(t,r.props),i=n(n({},r.props.reduxForms[r.props.name]),{formValues:n(n({},r.props.reduxForms[r.props.name].formValues),(o={},o[t.name]=a,o))});r.props.updateValidatedForm({formName:r.props.name,newFormState:n(n({},i),{formIsValid:!Object.values(i.formValues).find((function(e){return e.error}))})})},r.resetForm=function(){var e=l(r.formRef.current).reduce((function(e,o){var t,a=u(o,r.props,!0);return n(n({},e),((t={})[o.name]=a,t))}),{});r.props.updateValidatedForm({newFormState:{submissionAttempted:!1,formValues:e,formIsValid:!Object.values(e).find((function(e){return e.error}))},formName:r.props.name})},r}return t(r,o),r.prototype.componentDidMount=function(){var e,o=this,r={};l(null===(e=this.formRef)||void 0===e?void 0:e.current).forEach((function(e){var t,n;e.name?((null===(t=o.props.customValidators[e.name])||void 0===t?void 0:t.isValid)&&!(null===(n=o.props.customValidators[e.name])||void 0===n?void 0:n.errorText)&&console.error("A custom error message must be provided when using a custom isValid function for field:",e),r[e.name]=u(e,o.props,!0)):s(e)&&console.error("You must have a name on all form fields within ValidatedForm",e)})),this.props.updateValidatedForm({formName:this.props.name,newFormState:{submissionAttempted:!1,formIsValid:!Object.values(r).find((function(e){return e.error})),formValues:r}})},r.prototype.render=function(){var o=this,r=this.props,t=(r.onInvalidSubmissionAttempt,r.onValidSubmissionAttempt,r.updateValidatedForm,r.customValidators,r.className),i=r.children,s=(r.initialFieldValues,r.reduxForms),l=r.name,u=r.formErrorClass,m=a(r,["onInvalidSubmissionAttempt","onValidSubmissionAttempt","updateValidatedForm","customValidators","className","children","initialFieldValues","reduxForms","name","formErrorClass"]),d=s[l];return e.createElement("form",n({ref:this.formRef,onSubmit:this.onFormSubmit},m,{className:"validated-form "+((null==d?void 0:d.submissionAttempted)?"validated-form-submission-attempted ":"")+((null==d?void 0:d.formIsValid)?"":u)+(null!=t?t:"")}),e.Children.toArray(i).map((function(r){var t,a;return"button"===r.type?r:e.cloneElement(r,n(n({},r.props),{value:null!==(a=null===(t=null==d?void 0:d.formValues[r.props.name])||void 0===t?void 0:t.value)&&void 0!==a?a:"",onChange:r.props.onChange?function(e){o.fieldChanged(e),r.props.onChange(e)}:o.fieldChanged}))})))},r.defaultProps={customValidators:{},initialFieldValues:{},formErrorClass:"validated-form-error"},r}(e.Component)),v={},V=function(e,o){var r;if(void 0===e&&(e=v),[f,p,d].includes(o.type)){var t=o.payload,a=t.formName,i=t.newFormState;switch(o.type){case d:return n(n({},e),((r={})[a]=n({},i),r));default:return e}}return e};export{m as ValidatedForm,c as ValidatedReduxForm,V as validatedForms};
//# sourceMappingURL=index.js.map
